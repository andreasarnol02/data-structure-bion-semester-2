name: Java CI/CD Pipeline

# Trigger the workflow on push and pull requests
on:
  push:
    branches: [ '*' ]
  pull_request:
    branches: [ '*' ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    # Checkout the repository code
    - name: Checkout code
      uses: actions/checkout@v4

    # Set up Java environment
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'

    # Compile Java files in all directories
    - name: Compile Java files
      run: |
        echo "üî® Compiling Java files..."
        
        # Find all directories containing Java files and handle spaces properly
        find . -name "*.java" -exec dirname {} \; | sort -u | while IFS= read -r dir; do
          echo "üìÅ Processing directory: $dir"
          if [ -n "$(find "$dir" -maxdepth 1 -name "*.java")" ]; then
            echo "Compiling Java files in: $dir"
            # Use pushd/popd to handle directories with spaces
            pushd "$dir" > /dev/null
            javac *.java
            if [ $? -eq 0 ]; then
              echo "‚úÖ Successfully compiled Java files in: $dir"
            else
              echo "‚ùå Failed to compile Java files in: $dir"
              popd > /dev/null
              exit 1
            fi
            popd > /dev/null
          fi
        done
        
        # Check if any Java files were found
        if [ -z "$(find . -name "*.java")" ]; then
          echo "‚ö†Ô∏è No Java files found in the repository"
          exit 1
        fi
    
    # Clean up compiled files
    - name: Cleanup
      run: |
        echo "üßπ Cleaning up compiled files..."
        
        # Find and delete all .class files
        class_files=$(find . -name "*.class")
        if [ -n "$class_files" ]; then
          echo "Removing compiled .class files..."
          find . -name "*.class" -delete
          echo "‚úÖ Cleanup completed!"
        else
          echo "‚ÑπÔ∏è No .class files found to clean up"
        fi